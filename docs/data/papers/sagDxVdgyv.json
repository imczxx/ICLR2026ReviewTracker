{"id": "sagDxVdgyv", "number": 12225, "cdate": 1758206452774, "mdate": 1763434852425, "content": {"title": "Scalable Batch Correction for Cell Painting via Batch-Dependent Kernels and Adaptive Sampling", "abstract": "Cell Painting is a microscopy-based, high-content imaging assay that captures rich morphological profiles of cells.\nBy revealing how cells respond to different chemical perturbations, it can provide valuable insight for drug discovery. However, Cell Painting data suffers from batch effects caused by variations across laboratories, instruments, and protocols. These batch-dependent artifacts obscure biological signals, especially at scale. We introduce BALANS (read \"balance'')---Batch Alignment via Local Affinities and Subsampling---a scalable batch correction method that aligns samples across batches using a smoothing affinity matrix constructed based on pairwise distances between the data points. Given $n$ data points, BALANS constructs a sparse affinity matrix $A \\in \\mathbb{R}^{n \\times n}$ following two key ideas. First, for data points $i$ and $j$, it defines a local ``scale'' based on the distance from $i$ to its $k$-th nearest neighbor within the batch of $j$. The affinities $A_{ij}$ are then computed using a Gaussian kernel calibrated by the local scales to  account for batch-specific variation. Second, instead of populating all $n^2$ entries of $A$, BALANS employs an adaptive sampling strategy that incrementally computes rows corresponding to points with low cumulative neighbor coverage and, within each row, retains the highest affinities. This yields a sparse but informative submatrix of $A$. We prove that this novel sampling strategy is order-optimal in terms of sample complexity  and has an approximation guarantee. Crucially, BALANS runs in almost-linear time with respect to the number of data points. We evaluate BALANS across many real-world datasets spanning diverse biological conditions and batch structures. We demonstrate scalability on these real-world datasets and perform controlled scalability experiments on large-scale synthetic data to assess efficiency under varying size and complexity. In both cases, BALANS outperforms native implementations of popular batch correction methods in runtime without compromising batch correction quality.", "tldr": "BALANS is a fast, theoretically grounded method for batch correction in Cell Painting data, which estimates a sparse affinity matrix using batch-dependent scales and an optimal adaptive sampling strategy.", "keywords": ["Computational Biology", "Cell Painting", "Batch Correction", "Low-Rank Matrix Approximation", "Nearest Neighbor Graphs", "High-dimensional Data", "Image-based Profiling"], "primary_area": "applications to physical sciences (physics, chemistry, biology, etc.)", "venue": "ICLR 2026 Conference Submission", "pdf": "/pdf/6ff203ce4ceb8f3188899cb2255f839339c240be.pdf", "supplementary_material": "/attachment/8056ff4c645b2668abb4d8cd346a4815d676c0d2.zip"}, "replies": [{"content": {"summary": {"value": "The authors propose a method for batch correcting imaging-based cellular representations. This involves building a affinity matrix between pairs of cells which takes into account the batch that each cell belongs to. Naiively building an N x N affinity matrix would scale poorly, since modern optical pooled screening datasets such as the JUMP dataset contain millions of cells. Therefore, they suggest a way to build a low-rank approximation of the affinity matrix where each cell is sampled proportionately to its affinity to already-sampled cells. There are theoretical guarantees regarding the coverage of important biological groups, the reconstruction error of the affinity matrix, and the algorithm's runtime. Empirical results on datasets from the JUMP consortium, as well as large synthetic datasets, demonstrate that the authors' approach preserves biological signal while reducing batch effects."}, "soundness": {"value": 3}, "presentation": {"value": 3}, "contribution": {"value": 3}, "strengths": {"value": "* The main idea is relatively simple, and involves correcting for the batch when estimating the affinity matrix, which is then used for the Nystrom method.\n* The remaining contributions are to propose a computationally efficient way to estimate a submatrix with desirable properties, such as having good coverage of the biological groups, and having almost-linear runtime.\n* The sampling algorithm introduces very few hyperparameters, which facilitates model selection.\n* The experimental results are consistently strong, and involve evaluating on large-scale datasets such those from the JUMP consortium.\n* The experimental protocol is solid, and they compare against many relevant baselines."}, "weaknesses": {"value": "The theoretical results involve the Moore-Penrose pseudoinverse, but the implementation excludes it for computational reasons."}, "questions": {"value": "Could you comment on the gap between theory and practice induced by excluding the Moore-Penrose pseudoinverse? Can you provide any empirical evidence showing what effect this has?"}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "rating": {"value": 6}, "confidence": {"value": 2}, "code_of_conduct": {"value": "Yes"}}, "id": "rDk3ERHDV4", "forum": "sagDxVdgyv", "replyto": "sagDxVdgyv", "signatures": ["ICLR.cc/2026/Conference/Submission12225/Reviewer_Kgnu"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission12225/Reviewer_Kgnu"], "number": 1, "invitations": ["ICLR.cc/2026/Conference/Submission12225/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1761905550188, "cdate": 1761905550188, "tmdate": 1762923170259, "mdate": 1762923170259, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}, {"content": {"summary": {"value": "The authors introduce BALANS (Batch Alignment via Local Affinities and Subsampling). BALANS is a scalable method for batch integration of cell patining data. The method constructs an affinity matrix using a batch-aware affinity function. To avoid computing the full affinity matrix, the authors propose a sparse, low-rank approximation of the affinity matrix using landmark subsampling."}, "soundness": {"value": 3}, "presentation": {"value": 2}, "contribution": {"value": 2}, "strengths": {"value": "- The problem and the rationale behind the method are well illustrated.\n- Compared to the baseline methods, BALANS demonstrates a fast run-time, which is important for applications to high-throughput cell painting assays.\n- The paper shows theoretical and empirical analysis of the algorithm."}, "weaknesses": {"value": "- To me, BALANS seems very similar to BBKNN [1], which is not cited, compared to or discussed in the paper. BBKNN constructs a graph by independently identifying k-nearest neighbors for each cell within each batch, and then merges these neighbor sets. This seems similar to the batch-dependent local scale. Furthermore, BBKNN utilizes annoy instead of the lower-rank approximation to compute the affinity matrix efficiently, and the paper claims that it runs in linear time complexity.\n- BALANS requires the number of clusters K as input, which creates an unfair advantage over other methods that do not rely on this prior information and presents a practical challenge since K is typically difficult to determine beforehand.\n- BLANAS only makes assumptions on the structure of the biological signal, but does not make any assumptions about the batch effect.\n- The paper makes no connection between the theoretical results and the empirical results.\n- The assumptions about the data-generating process are not connected to cell painting data.\n- Table 1: While the methods themselves are largely deterministic, the evaluation pipeline contains stochastic elements. Variation in random seeds for Leiden clustering can substantially impact NMI and ARI.\n- The performance increase over other methods is limited.\n- I couldn't find the appendix to the paper. If this is an oversight on my part, I am happy to review it during the rebuttal and adjust my score.\n\n**Minor:**\n- Typo in line 295, $m(\\geq C(ϑ)tKlog K)$.\n- Table 2 and Figure 4 show very similar results. One could be moved to the appendix.\n- Page numbers are not showing in the paper.\n- Figure 3 is never discussed in the paper.\n- The paper starts with Assumption 2.\n\n[1] Krzysztof Polański, Matthew D Young, Zhichao Miao, Kerstin B Meyer, Sarah A Teichmann, Jong-Eun Park, BBKNN: fast batch alignment of single cell transcriptomes, Bioinformatics, Volume 36, Issue 3, February 2020, Pages 964–965, https://doi.org/10.1093/bioinformatics/btz625"}, "questions": {"value": "- How does BALANS differ from BBKNN, and how does its performance compare to it?\n- How was the number of clusters $K$ determined for running BALANS? How robust is BALANS to misspecifying this number?\n- How are the theoretical results related to the empirical results?\n- How is cell painting data related to the assumptions made about the data generation?\n- Do batch effects violate the noise model assumed in Assumption 3?\n- Usually, some correlation between NMI and ARI is expected in batch integration benchmarks, see for example [1]. However, here ARI is consistently very close to zero while NMI is relatively high. Is there an explanation for this? (I am aware that [2] shows these results as well. I am just curious.)\n- How was fastMNN evaluated? On the embedding it generates or the batch correction of the feature space?\n- How does scVI apply to this data? scVI employs a ZINB loss, which is designed for count data. However, cell profiler features are not count data.\n\n[1] Luecken, M.D., Büttner, M., Chaichoompu, K. _et al._ Benchmarking atlas-level data integration in single-cell genomics. _Nat Methods_ **19**, 41–50 (2022).\n\n[2] Arevalo, J., Su, E., Ewald, J.D. et al. Evaluating batch correction methods for image-based cell profiling. Nat Commun 15, 6516 (2024). https://doi.org/10.1038/s41467-024-50613-5"}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "rating": {"value": 2}, "confidence": {"value": 4}, "code_of_conduct": {"value": "Yes"}}, "id": "VEZfpwHPCA", "forum": "sagDxVdgyv", "replyto": "sagDxVdgyv", "signatures": ["ICLR.cc/2026/Conference/Submission12225/Reviewer_cxaA"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission12225/Reviewer_cxaA"], "number": 2, "invitations": ["ICLR.cc/2026/Conference/Submission12225/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1761951409732, "cdate": 1761951409732, "tmdate": 1762923169748, "mdate": 1762923169748, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}, {"content": {"summary": {"value": "This paper introduces a scalable batch correction method (BALANS) for cell painting assay via local affinities and adaptive sampling. It addresses batch effects, variations introduced by differences in labs, instruments, or protocols, instead of biological heterogeneity, by aligning samples across batches using a sparse, batch-aware affinity matrix. \nFor the empirical experiments, BALANS was benchmarked against various batch correction methods across a diverse sets of metrics and datasets, and was shown to outperform the baselines across metrics in general. BALANS also scales much better with number of samples and archives faster runtime than existing methods."}, "soundness": {"value": 3}, "presentation": {"value": 2}, "contribution": {"value": 3}, "strengths": {"value": "1. This paper is well organized and flows naturally; the need for addressing batch effects is clearly motivated.\n\n2. Combining batch-aware local affinities with adaptive sampling and low rank approximation is a scalable and well-reasoned solution.\nThe authors provide proofs for coverage guarantees and approximation error bounds of the sparse affinity matrix.\n\n3. Evaluations span multiple real-world Cell Painting datasets and synthetic scalability tests; BALANS achieves consistently strong performance and outperforms baselines in runtime. Runtime scales near-linearly with sample size and demonstrates significant speedup over existing methods."}, "weaknesses": {"value": "1. Core ideas like adaptive kernels and landmark-based sampling are not entirely new for biological data or affinity matrix computation. Prior work using adaptive bandwidths and landmark-based scalable affinity construction, such as PHATE (by Kevin Moon et al.), is not cited.\n2. Figure 4 is presented but lacks sufficient interpretation or biological insight; more discussion of qualitative improvements would strengthen the narrative.\n3. While quantitative metrics are discussed, more analysis on why BALANS performs better in certain settings (or fails in others) would be valuable."}, "questions": {"value": "This paper addresses an important and practical problem, batch correction, with a method that is theoretically grounded and empirically strong, but lacks originality in some components and could better discuss qualitative/quantitative insights."}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "rating": {"value": 6}, "confidence": {"value": 3}, "code_of_conduct": {"value": "Yes"}}, "id": "0eYfGSnVxa", "forum": "sagDxVdgyv", "replyto": "sagDxVdgyv", "signatures": ["ICLR.cc/2026/Conference/Submission12225/Reviewer_GiUr"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission12225/Reviewer_GiUr"], "number": 3, "invitations": ["ICLR.cc/2026/Conference/Submission12225/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1761979631277, "cdate": 1761979631277, "tmdate": 1762923169169, "mdate": 1762923169169, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}], "withdrawn": false}