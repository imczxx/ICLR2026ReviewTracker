{"id": "VfzJTurcgh", "number": 12357, "cdate": 1758207267660, "mdate": 1759897514983, "content": {"title": "Decoupled Classifier-Free Guidance for Counterfactual Diffusion Models", "abstract": "Counterfactual generation aims to simulate realistic hypothetical outcomes under causal interventions. Diffusion models have emerged as a powerful tool for this task, combining DDIM inversion with conditional generation and classifier-free guidance (CFG). In this work, we identify a key limitation of CFG for counterfactual generation: it prescribes a global guidance scale for all attributes, leading to significant spurious changes in inferred counterfactuals. To mitigate this, we propose \\textit{Decoupled Classifier-Free Guidance} (DCFG), a flexible and model-agnostic guidance technique that enables attribute-wise control following a causal graph. DCFG is implemented via a simple attribute-split embedding strategy that disentangles semantic inputs, enabling selective guidance on user-defined attribute groups. Our experiments demonstrate that DCFG significantly improves the axiomatic soundness of inferred counterfactuals on challenging medical imaging data, mitigating spurious amplification effects, and enhancing counterfactual reversibility.", "tldr": "", "keywords": ["Counterfactual Generation; Diffusion Models; Classifier-Free Guidance"], "primary_area": "generative models", "venue": "ICLR 2026 Conference Submission", "pdf": "/pdf/bf0ddbd62005f3d1b57f27a8b32c361c0da6ffa5.pdf", "supplementary_material": ""}, "replies": [{"content": {"summary": {"value": "The authors propose Decoupled Classifier-Free Guidance, a counterfactual image generation method based on classifier-free guidance. The difference to prior work is that the authors cluster attributes into different groups and apply different guidance weights to them. THe method is empirically evaluated on CelebA-HQ, MIMIC-CXR and EMBED."}, "soundness": {"value": 2}, "presentation": {"value": 3}, "contribution": {"value": 1}, "strengths": {"value": "1. The paper is well-written. I appreciate how the approach is contrasted with the existing method by [1]. It becomes immediately clear what is done differently in this work.\n\n2. The experimental evaluation is quite strong. The method is demonstrated on many different data sets with many examples. I am not a radiologist, so I cannot judge the mammograms and chest x-ray images. However, it is clear that this is an important application domain.\n\n3. The proposed method is simple.\n\n[1] Sanchez, Pedro, and Sotirios A. Tsaftaris. \"Diffusion causal models for counterfactual estimation.\" Conference on Causal Learning and Reasoning (2022)."}, "weaknesses": {"value": "1. My main concern with this method is that it is somewhat trivial. The only novelty seems to lie in a grouping of attribute variables and then applying different guidance strengths to each group. Given the lack of contribution, I am afraid that this work is far from being publishable.\n\n2. The soundness of this method is also not so clear to me. From a mathematical perspective, the weights $w_i$ should actually all be $1$. Also, the authors propose to have one weight for the \"affected\" variables and an additional weight for \"unaffected\" variables and it is not clear why this is a reasonable grouping. Generally, I do not see any deeper grounding to the argument of why we should group attributes and apply different guidance weights to them and why the groups are chosen the way that they are.\n\n3. Some notation could be improved. For instance the $\\mathrm{pa}$ notation: In case the authors do not know it, \"$\\mathrm{pa}$\" means \"parents\", in the sense of \"causal parents\". I would therefore not use $\\mathrm{pa}^{(m)}$ to denote attribute groupings, because it sounds as if we are grouping variables by their causal mechanisms (which is apparently not the case)."}, "questions": {"value": "* I highly suggest to remove \"proposition 1\". This factorization is trivial and there is nothing to be proved, as far as I can see. Maybe I am missing something?\n\n* I do not understand why the method is based on classifier-free guidance. It seems to me that the method could also be implemented with classifier guidance.\n\n* Why is the method called \"Decoupled Classifier-Free Guidance\"? What is decoupled? It seems more that it is grouped, so should be called something like \"Grouped Classifier-Free Guidance\".\n\n* In appendix D, it says that the anti-correlation between \"young\" and \"male\" stems from data set bias. What is \"data set bias\"? To me it seems more like selection bias: Given that someone is a celebrity, being young and female are dependent."}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "rating": {"value": 2}, "confidence": {"value": 4}, "code_of_conduct": {"value": "Yes"}}, "id": "EvPrWDfVZ4", "forum": "VfzJTurcgh", "replyto": "VfzJTurcgh", "signatures": ["ICLR.cc/2026/Conference/Submission12357/Reviewer_6N8V"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission12357/Reviewer_6N8V"], "number": 1, "invitations": ["ICLR.cc/2026/Conference/Submission12357/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1760614462588, "cdate": 1760614462588, "tmdate": 1762923272518, "mdate": 1762923272518, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}, {"content": {"summary": {"value": "This paper identifies a key limitation in the conventional Classifier-Free Guidance (CFG) approach for counterfactual generation: applying a global guidance weight $\\omega$ to the entire counterfactual embedding can violate causal relations and unintentionally alter attributes that should remain unchanged. To address this issue, the author proposes Decoupled Classifier-Free Guidance (DCFG), which employs multiple MLPs, each corresponding to a specific attribute, to generate independent semantic attribute vectors and provide more targeted counterfactual generation guidance. The DCFG framework is evaluated on three datasets, demonstrating its effectiveness over conventional CFG."}, "soundness": {"value": 2}, "presentation": {"value": 3}, "contribution": {"value": 2}, "strengths": {"value": "1. The discussion on how traditional CFG can violate causal relations is interesting and can be inspirational for future research in counterfactual generation.\n\n2. DCFG shows promising performance across all case studies.\n\n3. The paper presents a clear and thorough explanation of the technical background and motivation."}, "weaknesses": {"value": "1. The proposed solution, which uses a separate MLP for each attribute, is not scalable. For instance, while the CelebA-HQ experiments involve only three attributes, the CelebA dataset includes 40 attributes. Applying DCFG to all attributes would require 40 MLPs, which raises a serious concern on the scalability.\n\n2. Related areas such as disentangled representation learning and debiasing for protected attributes have extensively explored methods for isolating and manipulating specific attribute features without affecting others. Although the paper claims to focus on counterfactual inference and structural causal models, its discussion of causality remains limited. Beyond the abduction–action–prediction procedure, there is little discussion to causal graphs or explicit modeling of causal relations.\n\n3. The experiment setup appears closer to studying disentangled representation learning rather than causality, as the attributes used in the case studies (e.g., Figure A.1) are independent with each other rather than causally related. Consequently, the experiments may not sufficiently demonstrate DCFG’s ability to leverage causal relations for counterfactual generation."}, "questions": {"value": "Please refer to the Weaknesses."}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "rating": {"value": 2}, "confidence": {"value": 3}, "code_of_conduct": {"value": "Yes"}}, "id": "bMp1zTsmfX", "forum": "VfzJTurcgh", "replyto": "VfzJTurcgh", "signatures": ["ICLR.cc/2026/Conference/Submission12357/Reviewer_4vnV"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission12357/Reviewer_4vnV"], "number": 2, "invitations": ["ICLR.cc/2026/Conference/Submission12357/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1761829172037, "cdate": 1761829172037, "tmdate": 1762923272170, "mdate": 1762923272170, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}, {"content": {"summary": {"value": "In this work, the authors address the issue that classifier-free guidance for counterfactual generation can lead to attribution amplification, referring to unwanted correlations between attributes. To mitigate this problem, they propose a new method, decoupled classifier free guidance, which leverages a causal graph. The proposed approach is evaluated on three datasets, including CelebA, mammography, and chest X-rays, and demonstrates convincing results."}, "soundness": {"value": 3}, "presentation": {"value": 3}, "contribution": {"value": 2}, "strengths": {"value": "1. The motivation of this work is solid and well-justified. Avoiding spurious correlations in generative models is a challenging task that is worth pursuing.\n2. This work provides the necessary prerequisites for understanding the paper in Section 2. The structure of the paper is clear and easy to follow, and the writing is overall clear and coherent.\n3. The visualizations of the results are quite convincing.\nThe evaluation of the generated images in terms of effectiveness and reversibility also makes sense for counterfactual generation tasks.\n4. I also appreciate the effort of including medical data, as it is valuable to incorporate datasets that are closer to real-world settings."}, "weaknesses": {"value": "1. The paper lacks prior literature discussing the issue of attribute amplification. I believe a paragraph in sec 2 dedicated to attribute amplification is needed, clarifying how it is defined and summarizing previous studies that have encountered this issue, especially in the context of counterfactual generation.\n\n2. There is also a lack of details on how the CFG model was trained. I am somewhat confused about the training setup: did the authors use only the target attributes for supervision, or were other attribute annotations included as well?\n\n3. There are no numerical results presented in tables; all results are shown in figures, which makes it difficult to assess quantitative values. This could be considered a minor weakness.\n\n4. Regarding reproducibility, it does not appear that the experiments were conducted with multiple random seeds."}, "questions": {"value": "1. I am a bit unsure about why it needs to be a CFG for counterfault generation. As I believe for generating counterfactual, you have a target in mind, for example, change the disease label from 0 to 1, it makes more sense to have a classifier guidance to me. Can you explain the intuition of having CFG here? \nFollowing this question, the biassed results only happen when w is bigger, whether more and more CFM is introduced. If it is purely classifier guided, will there still be such an issue?"}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "rating": {"value": 4}, "confidence": {"value": 3}, "code_of_conduct": {"value": "Yes"}}, "id": "tGReHKXvXI", "forum": "VfzJTurcgh", "replyto": "VfzJTurcgh", "signatures": ["ICLR.cc/2026/Conference/Submission12357/Reviewer_MDyx"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission12357/Reviewer_MDyx"], "number": 3, "invitations": ["ICLR.cc/2026/Conference/Submission12357/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1761885521314, "cdate": 1761885521314, "tmdate": 1762923271635, "mdate": 1762923271635, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}, {"content": {"summary": {"value": "The paper proposes Decoupled Classifier-Free Guidance (DCFG), a simple yet effective modification of standard classifier-free guidance (CFG) for counterfactual diffusion models. Standard CFG suffers from the problem of *attribute amplification*, where increasing the guidance strength for one intervention unintentionally alters correlated attributes (e.g., changing “Young” decreases “Male”). DCFG addresses this by splitting attributes into disjoint groups (intervened vs. invariant) and assigning separate guidance weights for each group. This decoupling enables more disentangled, causally faithful counterfactuals without retraining or architectural changes. Experiments on CelebA-HQ, EMBED (mammography), and MIMIC-CXR show that DCFG reduces amplification and improves reversibility compared to standard CFG."}, "soundness": {"value": 3}, "presentation": {"value": 3}, "contribution": {"value": 2}, "strengths": {"value": "- **Practical and elegant idea:** The attribute-split conditioning mechanism is extremely simple and requires minimal changes to existing diffusion pipelines while producing clear improvements.  \n- **Generality:** The approach is model-agnostic and could extend to other settings.\n- **Strong empirical validation:** Results are shown across both natural and medical datasets with quantitative metrics and convincing qualitative examples. The inclusion of reversibility and cross-attribute correlation analysis is helpful and demonstrates the problem concretely."}, "weaknesses": {"value": "* **Clarity of motivation and intuition.**\n  The paper tackles an important issue (attribute amplification in classifier-free guidance) but why this happens is not very clearly explained. The reviewer had to re-read [1] and infer the connection independently. Including a brief intuitive explanation, figure or toy example would make the motivation easier to grasp.\n\n* **Simplicity and missing contextualization.**\n  The proposed fix of splitting attributes into intervened and invariant groups and applying separate guidance weights is extremely simple and easy to adopt, which is a strength. However, the paper does not discuss whether similar disentangling or conditional-guidance approaches have been explored before, or how this method compares to more sophisticated alternatives for representation disentanglement. A short discussion or empirical comparison would clarify novelty.\n\n* **Missing baselines and ablations.**\n  The experiments compare only to standard CFG. It would strengthen the work to include other diffusion-based counterfactual explanation or editing baselines (e.g., [2], [3]).\n\n* **Incomplete evaluation metrics.**\n  The paper does not report realism measures such as FID or sFID, nor composition or minimality metrics commonly used in counterfactual image generation. The authors explain the omission of composition in the Appendix, mentioning this in the main text would help. Measuring also minimality through a VLM or a user study, or a brief note on why it is difficult to quantify would make the evaluation more comprehensive.\n\n* **Unaddressed observations.**\n  In Figure 1, increasing guidance for *do(Young)* appears to reduce *Male*, likely due to a dataset bias that biases the classifier. This should be discussed and attributed to this bias or another factor. Figure 5 shows similar unexplained behavior (*do(circle)* affecting density AUROC).\n\n* **Minor presentation issues.**\n  - Figure 5 would benefit from same interventions between subfigures.\n  - Figure 3 is difficult to read and should be split.\n  - Equation (5) seems to omit $\\tilde{x}$\n  - Equation (12) may need a $(1-\\omega)$ term for completeness\n  - line 284 should reference Appendix C.\n\n[1] Tian Xia, Mélanie Roschewitz, Fabio De Sousa Ribeiro, Charles Jones, and Ben Glocker. Mitigating\nattribute amplification in counterfactual image generation. In International Conference on Medical\nImage Computing and Computer-Assisted Intervention, pp. 546–556. Springer, 2024.\n\n[2] Guillaume Jeanneret, Loı̈c Simon, and Frédéric Jurie. Diffusion models for counterfactual explana-\ntions. In Proceedings of the Asian conference on computer vision, pp. 858–876, 2022.\n\n[3] Preechakul, K., Chatthee, N., Wizadwongsa, S., & Suwajanakorn, S. (2022). Diffusion Autoencoders: Toward a Meaningful and Decodable Representation. IEEE Conference on Computer Vision and Pattern Recognition (CVPR)."}, "questions": {"value": "1. Can you provide a clearer intuition, illustrative example or figure for why CFG leads to attribute amplification?\n2. Have you tried a version that removes invariant attributes from conditioning entirely?\n3. How does DCFG compare with other diffusion-based counterfactual or editing methods such as DiME, or diffusion autoencoders?\n4. Can you report or discuss realism metrics (FID/sFID) and briefly justify the exclusion of composition/minimality metrics?\n5. Could you clarify the observed cross-attribute effects in Figures 1 and 5 and verify the potential inconsistencies in Equations (5) and (12)?"}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "rating": {"value": 6}, "confidence": {"value": 4}, "code_of_conduct": {"value": "Yes"}}, "id": "6RzfRZdYnm", "forum": "VfzJTurcgh", "replyto": "VfzJTurcgh", "signatures": ["ICLR.cc/2026/Conference/Submission12357/Reviewer_4VNU"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission12357/Reviewer_4VNU"], "number": 4, "invitations": ["ICLR.cc/2026/Conference/Submission12357/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1761946424785, "cdate": 1761946424785, "tmdate": 1762923271106, "mdate": 1762923271106, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}], "withdrawn": false}