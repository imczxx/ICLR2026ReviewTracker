{"id": "1Q2NVxcSuS", "number": 22163, "cdate": 1758326958979, "mdate": 1759896882852, "content": {"title": "LONGSHIELD: SCALABLE DISTRIBUTED DIFFERENTIALLY PRIVATE TRAINING FOR LONG-CONTEXT LLMS", "abstract": "Large language models excel at in-context learning but can memorize sensitive sequences, enabling membership-inference and extraction attacks. Differential privacy (DP) offers provable protection, yet DP training remains costly at long contexts. Prior work largely targets short-sequence DP fine-tuning, and the strongest public DP pretraining scales only to 1B parameters at 1,024 tokens. Profiling state-of-the-art distributed DP reveals two blockers: **efficiency** losses from a mixed ghost-norm clipping heuristic that wastes compute at longer sequences, and **scalability** limits where FSDP alone cannot break the single-GPU memory ceiling for sequence length. We introduce LongShield, a memory- and communication-efficient context-parallel DP training method that closes the performance gap to non-DP while enabling long-context scaling on modest GPU budgets. LongShield keeps per-sample gradients shard local to each GPU to avoid full materialization, overlaps per-sample gradient aggregation with backward computation to sustain throughput, and enables DP-safe activation checkpointing to further extend context. These system changes leave the underlying DP algorithm and accounting unchanged and use flat clipping for best convergence. On Llama-3.1-8B with 4√óNVIDIA H100, LongShield scales sequence length from 4k to 16k, achieves linear sequence-length scaling, and shrinks the DP‚Äìnon-DP throughput gap from 50% to 7% while matching non-DP memory usage. With activation checkpointing, LongShields reaches 32k context at the expected checkpointing overhead. These results show that long-context DP training is practical on modest GPU budgets.", "tldr": "", "keywords": ["Differential Privacy", "LLM", "Distributed training"], "primary_area": "infrastructure, software libraries, hardware, systems, etc.", "venue": "ICLR 2026 Conference Submission", "pdf": "/pdf/55e10ccd33eac9ec0b5e38359f30d30edb3d2ee5.pdf", "supplementary_material": ""}, "replies": [{"content": {"summary": {"value": "This paper introduces LongShield which integrates context parallelism to DP (differentially private) training method aka DP-SGD. The main contribution of the paper is to integrate context parallelism on top of FSDP (ZERO-DP+) for training LLMs with large context using differentially private algorithms such as DP-SGD. The paper also enables DP-safe activation checkpointing to extend context further.  On Llama 3.1 8B with 4√ó NVIDIA H100 GPUs, LongShield scales sequence length from 4k to 16k compared to the state-of-the-art ZeRO-DP, achieves linear sequence-length scaling, shrinks the throughput gap from 67% to 8.9% while matching non-DP memory usage, and\nreaches a 64k context length with activation checkpointing."}, "soundness": {"value": 2}, "presentation": {"value": 1}, "contribution": {"value": 2}, "strengths": {"value": "1. The paper identifies that for large context lengths, ghost clipping introduces significant memory overhead and shits to computing pure grad sample to integrate context parallelism to ZERP-DP+\n2. LongShield keeps per-sample gradients shards local to each GPU to avoid full materialization, overlaps per-sample gradient aggregation with backward computation to sustain throughput.\n3. The paper enables DP-safe activation checkpointing to extend context further.\n4. The paper presents experimental results on Llama 3.2 1B, Llama 3.2 3B, and Llama 3.1 8B over 4√ó H100 GPU and show that LongShield scales sequence length from 4k to 16k compared to the state-of-the-art ZeRO-DP."}, "weaknesses": {"value": "1. The main weakness of the paper is that LongShield computes per-gradient sample which is notorious for preserving the per-sample gradient over the entire model instead of using Fast Gradient Clipping (FGC) to avoid ghost clipping's $T^2$ overhead. This choice has not been justified if there is indeed some benefit (in-terms of throughput) in computing per-sample gradient of the entire model instead of FGC with two backward passes.\n2. The paper was hard to follow, please add a pseudo-code similar to algorithm 1 for LongShield, ZERO-DP and ZERO-DP+. Please explain technical details of CP and how it integrates along with FSDP for DP-SGD more clearly.\n3. No codebase is provided."}, "questions": {"value": "Questions:\n1. \"We adopt the pure gradient-sample (GS) approach to avoid ghost overhead.\" -- This is unclear to me. I understand that Ghost Clipping introduces memory overhead proportional to $T^2$ but this can be eradicated by shifting to Fast Gradient Clipping. Why do we need to store the entire per-sample gradient instead of using Fasting Gradient Clipping + Two backwards passes if memory proportional to $T^2$ was indeed the bottleneck?\n2. ZERO-DP works with per-layer gradient clipping which doesn't yield good utility in terms of test accuracy. For ZeRO-DP+ results, are the experiments conducted for flat clipping instead of per-layer? \n3.  In my opinion, integrating CP and FSDP into DP-SGD with Fast Gradient Clipping is trivial. If this is not the case, then can the authors explain why?\n4. \"For example, mixed ghost norm choose ghost for Llama 3.1 8B final linear layer up to T= 16k. However, the ghost norm is 4√ó more FLOPs than directly evaluating the per-sample gradient, and the final dot product between two large intermediate tensors (ùëÇ(ùêµùëá2)) causes a similar time, according to our profiling, due to the reduction nature.\" -- this statement is not clear to me. Mixed GC will pick GC or FGC based on minimum overhead condition and GC has more FLOPs than FGC because 1) FGC includes one matmul of BxTxp and BxTxd, where as 2) GC has two matmuls (BxTxp with BxpxT, BxTxd with BxdxT) and one dot product ($B \\times T^2$ with $B \\times T^2$). The statement says that GC has similar time according to the profile but causes 8x slowdown, this part is not clear. \n5. Table 4 shows the results for ZERO-DP+ when it OOMs. How does LongShield perform in terms of throughput and peak memory when ZERO-DP+ doesn't OOM. Can we utilize LongShield to improve throughput even when ZERO-DP+ doesn't OOM?\n\n\nSuggestions\n1. In figure 1, mention the per-device batch-size and global batch-size. For example, in this particular figure, FSDP supports GBS of 2*MBS and a per-device batch-size of MBS. But with CP, we can support larger context length at the cost of per-device batch-size reduced to 1/2 and GBS of 1. This is not clear in the figure or in the paragraph below. \n2. Figure 4 and text below is not consistent. The text says \"we can all-to-all (A2A) exchange the activation tensor (shape changing from (MBS, T/2, p) to (MBS, T, p/2)) and then all-gather (AG) the activation gradient tensor (shape transferred from (MBS, T/2, d) to (MBS, T, d)).\" but the figure shows (MBS, T, p) and (MBS, T, d/2).  Please correct it."}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "details_of_ethics_concerns": {"value": "N/A"}, "rating": {"value": 2}, "confidence": {"value": 4}, "code_of_conduct": {"value": "Yes"}}, "id": "15lXLjD7IB", "forum": "1Q2NVxcSuS", "replyto": "1Q2NVxcSuS", "signatures": ["ICLR.cc/2026/Conference/Submission22163/Reviewer_fsdT"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission22163/Reviewer_fsdT"], "number": 1, "invitations": ["ICLR.cc/2026/Conference/Submission22163/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1760912684981, "cdate": 1760912684981, "tmdate": 1762942096338, "mdate": 1762942096338, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}, {"content": {"summary": {"value": "DP-SGD is the most used algorithm for training ML models with differential privacy. Prior literature (DP-ZeRO) has scaled DP-SGD training to very large models, but fails to scale to longer sequence lengths. Through a series of optimizations this paper scales from max sequence length of 4k (prior work) to 16k on the Llama-3 8B model. They use optimizations from the exisiting literature on LLM scaling such as  (1) context parallelism, (3) gradient sharding (3) activation checkpointing, and adapt these to work with DP-SGD."}, "soundness": {"value": 3}, "presentation": {"value": 2}, "contribution": {"value": 3}, "strengths": {"value": "- The paper achieves significant results in terms of scaling DP-SGD training to longer contexts. \n- Experimental results are comprehensive (although a bit hard to compare between methods given the separate tables for each method). \n- The paper provides important contributions in adapting popular scaling techniques such as context parallel and activation checkpointing to DP-SGD training, thus enabling further research in private LLM training. \n- I liked the insight on the limitations of ghost clipping for scaling to longer contexts."}, "weaknesses": {"value": "- The contributions are mainly engineering-oriented versus conceptual/algorithmic since existing methods from the non-private literature are extended somewhat straightforwardly to the private case.\n\n- The paper could be better self-contained. Several concepts are used without much explanation such as ghost clipping/ghost overhead, FSDP, context extension continue pre-training, the overlap of communication and computation in the input-stationary pattern."}, "questions": {"value": "- Will there be open-source code for this paper? That would be very important given that a lot of the contributions are engineering-oriented and would enable ongoing research in this area.  \n\n\nMore minor comments: \n- What is the meaning of \"large fragmentation\" in in the current Opacus imlementation? \n- Another relevant work/baseline might be \"Scaling Private Deep Learning with Opacus: Advances for Large Language Models\" which discuss FSDP with the ghost clipping approach."}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "details_of_ethics_concerns": {"value": "none"}, "rating": {"value": 6}, "confidence": {"value": 4}, "code_of_conduct": {"value": "Yes"}}, "id": "ZbKNcN07mi", "forum": "1Q2NVxcSuS", "replyto": "1Q2NVxcSuS", "signatures": ["ICLR.cc/2026/Conference/Submission22163/Reviewer_vekz"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission22163/Reviewer_vekz"], "number": 2, "invitations": ["ICLR.cc/2026/Conference/Submission22163/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1761619432621, "cdate": 1761619432621, "tmdate": 1762942096065, "mdate": 1762942096065, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}, {"content": {"summary": {"value": "This paper proposes LongShield, a system approach that combines context parallelism (CP) with existing differentially private (DP) training frameworks (e.g., Opacus + ZeRO-DP) to enable long-context DP training for LLMs. The key contributions include per-sample gradient sharding, communication overlap, and DP-compatible activation checkpointing. Experiments on Llama-3 models (1B‚Äì8B) show improved throughput and reduced memory over ZeRO-DP, scaling context length up to 64k tokens on 4√óH100 GPUs."}, "soundness": {"value": 2}, "presentation": {"value": 3}, "contribution": {"value": 2}, "strengths": {"value": "1. Clear and reproducible system engineering.\n\n2. Demonstrates that DP-SGD can scale to longer contexts using modest hardware.\n\n3. Addresses practical compatibility issues (e.g., checkpointing with DP hooks).\n\n4. Experimental evaluation on real Llama-3 models is thorough for throughput and memory."}, "weaknesses": {"value": "1. Weak novelty. The method essentially combines context parallelism with DP-SGD under existing frameworks. It does not introduce new algorithms, optimizers, or privacy accounting techniques.\n\n2. Lack of multi-dimensional parallelism. The system is confined to single-node CP. It does not explore or support other critical dimensions of LLM parallelism ‚Äî such as Tensor Parallel (TP), Pipeline Parallel (PP), Expert Parallel (EP), or ZeRO data sharding. The paper even notes communication challenges would ‚Äúbecome more critical‚Äù beyond one node, but never verifies cross-node scalability. Consequently, the proposed method‚Äôs scalability under realistic distributed setups remains unclear.\n\n3. No integration with established frameworks. CP is already well-implemented in Megatron, which also provides integrated TP/PP/EP interfaces. The authors should compare their CP-DP implementation against a baseline that simply adds DP-SGD into Megatron. Moreover, they should explain why they did not directly integrate into Megatron ‚Äî doing so would have allowed evaluation under real multi-dimensional parallelism (ZeRO + TP + PP + CP + EP) and would strengthen the engineering contribution.\n\n4. Unconvincing motivation. The paper claims that DP is critical for long-context LLMs because ‚Äúlong sequences may contain sensitive data,‚Äù but provides no empirical evidence (e.g., no memorization or membership-inference study) to support that assumption.\n\n5. No privacy evaluation. The paper lacks Œµ/Œ¥ reporting, attack-resistance analysis, or privacy‚Äìutility trade-off curves. As such, it demonstrates feasibility, not utility.\n\n6. Limited scientific insight. Improvements (gradient sharding, hook fix, communication overlap) are incremental engineering optimizations that could be implemented in existing systems with minor effort."}, "questions": {"value": "1. What privacy budgets (Œµ, Œ¥) were achieved in your experiments?\n\n2. How does DP noise affect model accuracy or perplexity?\n\n3. Have you compared your CP implementation with Megatron‚Äôs sequence-parallel engine?\n\n4. Could LongShield be integrated with Megatron to combine TP/PP/CP/DP?\n\n5. How does performance scale across nodes with slower interconnects (e.g., RDMA instead of NVLink)?"}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "rating": {"value": 2}, "confidence": {"value": 4}, "code_of_conduct": {"value": "Yes"}}, "id": "tCbzGtmAdV", "forum": "1Q2NVxcSuS", "replyto": "1Q2NVxcSuS", "signatures": ["ICLR.cc/2026/Conference/Submission22163/Reviewer_2uzq"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission22163/Reviewer_2uzq"], "number": 3, "invitations": ["ICLR.cc/2026/Conference/Submission22163/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1762089383592, "cdate": 1762089383592, "tmdate": 1762942095821, "mdate": 1762942095821, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}, {"content": {"summary": {"value": "This paper presents LongShield, a distributed framework for differentially private (DP) training of large language models (LLMs) under long-context settings. The method integrates context parallelism (CP) with per-sample gradient computation to achieve long-sequence scalability while maintaining DP guarantees."}, "soundness": {"value": 3}, "presentation": {"value": 3}, "contribution": {"value": 2}, "strengths": {"value": "1. Addresses an underexplored but important problem: long-context DP training.\n\n2. Demonstrates strong empirical results with practical improvements in scalability and throughput.\n\n3. Provides a clear implementation pathway compatible with Opacus and TorchTitan frameworks."}, "weaknesses": {"value": "1. The core idea (computing per-sample gradients under CP) is a direct extension of standard CP, replacing the local (p, d) gradient computation with (B, p, d) per-sample gradients. There is no new parallelism algorithm or architectural innovation beyond this dimensional extension.\n\n2. The ‚Äúinput-stationary vs. output-stationary‚Äù trade-off is not new; it mirrors prior analyses in FlashAttention-2 and Megatron-Ulysses. The overlap strategy is a routine engineering optimization rather than a conceptual advance.\n\n3. The paper emphasizes that FSDP cannot shard per-sample gradients while CP can, but this follows trivially from the existing data partitioning dimensions. It is a property of CP‚Äôs tensor layout, not a new design.\n\n4. The hook management fix for Opacus checkpointing is more of an implementation detail than a contribution; it does not introduce a new checkpointing strategy or fundamental compatibility solution.\n\n5. There is no formal analysis of privacy-utility trade-offs or communication complexity, and most claims rely purely on empirical evidence.\n\n6. The authors do not justify why long-context DP training is necessary or beneficial. While long-context modeling is relevant for general LLMs, it remains unclear whether the same motivation applies to private training. The experiments focus on throughput and context length scaling but omit any analysis of model utility, privacy-utility trade-offs, or downstream performance (e.g., perplexity, zero-shot tasks)."}, "questions": {"value": "1. Could the authors clarify whether any communication primitives or kernel fusion were re-implemented, or are all collectives reused from Megatron CP/Ulysses?\n\n2. How does LongShield differ in actual code structure from integrating DP-SGD directly into existing CP frameworks?\n\n3. Would privacy accounting or gradient clipping strategies change under model-parallel settings, or is the approach orthogonal to parallel dimension?\n\n4. Why is long-context DP training practically needed? Are there real-world datasets or use cases that specifically require both privacy and long context?"}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "rating": {"value": 2}, "confidence": {"value": 4}, "code_of_conduct": {"value": "Yes"}}, "id": "In1iQamhtU", "forum": "1Q2NVxcSuS", "replyto": "1Q2NVxcSuS", "signatures": ["ICLR.cc/2026/Conference/Submission22163/Reviewer_choR"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission22163/Reviewer_choR"], "number": 4, "invitations": ["ICLR.cc/2026/Conference/Submission22163/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1762140959835, "cdate": 1762140959835, "tmdate": 1762942095612, "mdate": 1762942095612, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}], "withdrawn": false}