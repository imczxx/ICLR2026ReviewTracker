{"id": "fkf7tlkN8q", "number": 2224, "cdate": 1757034697296, "mdate": 1763499433223, "content": {"title": "RNE: plug-and-play diffusion inference-time control and energy-based training", "abstract": "Diffusion models generate data by removing noise gradually, which corresponds to the time-reversal of a noising process.\nHowever, access to only the denoising kernels is often insufficient.\nIn many applications, we need the knowledge of the marginal densities along the generation trajectory, which enables tasks such as inference-time control.\nTo address this gap, in this paper, we introduce the Radon-Nikodym Estimator (RNE).\nBased on the concept of the density ratio between path distributions, it reveals a fundamental connection between marginal densities and transition kernels, providing a flexible plug-and-play framework that unifies diffusion density estimation, inference-time control, and energy-based diffusion training under a single perspective.\nExperiments demonstrated that RNE delivers strong results in inference-time control applications, such as  annealing and model composition, with promising inference-time scaling performance. \nMoreover, RNE provides a simple yet efficient regularisation for training energy-based diffusion.", "tldr": "", "keywords": ["diffusion generative models", "SDE", "SMC", "sequential monte carlo"], "primary_area": "generative models", "venue": "ICLR 2026 Conference Submission", "pdf": "/pdf/0619e184b0baa7fdf15f38c0ed93457bf9956259.pdf", "supplementary_material": ""}, "replies": [{"content": {"summary": {"value": "The paper proposes a novel **Radon–Nikodym Estimator (RNE)** framework that unifies marginal density estimation, inference-time control, and energy-based training in diffusion models. By leveraging time-reversal theory, RNE connects marginal densities and transition kernels without explicitly solving Fokker–Planck equations. Building on this, the **Radon–Nikodym Corrector (RNC)** enables plug-and-play inference-time control—including annealing, reward-tilting, and model composition—via sequential Monte Carlo weighting. Additionally, RNE serves as a principled regularizer for energy-based diffusion training and generalizes beyond standard diffusion models to stochastic interpolants, bridge models, and continuous-time Markov chains."}, "soundness": {"value": 3}, "presentation": {"value": 2}, "contribution": {"value": 3}, "strengths": {"value": "The paper presents a theoretically elegant and practically flexible framework for diffusion-based sampling. By introducing the Radon–Nikodym Estimator (RNE) and Corrector (RNC), it unifies marginal densities, transition kernels, and various correction techniques under a single probabilistic formalism. This approach enables plug-and-play inference-time control, bridges diffusion and energy-based modeling, generalizes beyond Gaussian diffusions, and demonstrates clear empirical improvements on tasks such as annealing, ligand design, and free-energy estimation, all while maintaining mathematical rigor and conceptual coherence."}, "weaknesses": {"value": "### About the bound of the importance weight\n\nOne potential weakness of the proposed method is that the guidance weight w(t) used in the conditional or composite sampling scheme is not explicitly constrained. When w(t) becomes too large or varies significantly over time, it can cause several issues:\n\n1. **High variance in importance weights** – In the sequential importance sampling / SMC interpretation, unbounded w(t) directly amplifies the RN derivative, which may lead to weight degeneracy, where only a few particles dominate the distribution. This reduces effective sample size and lowers approximation quality.\n2. **Numerical instability or reducing diversity** – Large w(t) can excessively scale the conditional drift/score term, potentially causing gradient explosion or unstable particle trajectories in continuous-time SDE sampling. And excessive weighting favors certain modes strongly, leading to collapse of particle diversity and biased approximation of the target marginal qt.\n\n### About CFG\n\nIn your formulation, **CFG** is considered as\n$$\nd \\tilde X_t=\\left(f_t(X_t)-(1-\\beta )\\sigma^2\\nabla\\log p_t^{(1)}-\\beta \\sigma^2_t\\nabla\\log p_t^{(2)}\\right)dt+\\sigma d\\bar W_t,\n$$\nhowever, in some practical or generalized settings, the CFG formulation takes the form:\n$$\nd \\tilde X_t=\\left(f_t(X_t)-\\sigma^2\\nabla\\log p_t^{(1)}-\\gamma \\sigma^2_t\\nabla\\log p_t^{(2)}\\right)dt+\\sigma d\\bar W_t,\n$$\ni.e., \n$$\n\\alpha \\neq (1-\\beta).\n$$\nUnder this more general setting, certain derivations or propositions in the appendix (e.g., **Proposition H.4**) may not hold exactly.\n Could the authors clarify:\n\n- whether their framework can accommodate the case \n  $$\n  \\alpha+\\beta\\neq 1;\n  $$\n\n- and if not, what theoretical or empirical assumptions justify enforcing \n  $$\n  \\alpha+\\beta=1\n  $$\n  in CFG-like processes?\n\n### Reading difficulty / dense derivations\n\nSome sections, especially the appendix and derivations of the CFG and RNE formulas, are mathematically dense. Readers may find it challenging to follow all steps without carefully tracing the equations. Adding more intuitive explanations or diagrams could improve accessibility."}, "questions": {"value": "### A little typo\n\nI believe there is an issue with the use of Girsanov's theorem at line **1763**. The formulation of the Radon-Nikodym derivative seems to be incomplete, as it is missing the standard **exponential term**."}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "rating": {"value": 6}, "confidence": {"value": 3}, "code_of_conduct": {"value": "Yes"}}, "id": "Rk3dlltqCh", "forum": "fkf7tlkN8q", "replyto": "fkf7tlkN8q", "signatures": ["ICLR.cc/2026/Conference/Submission2224/Reviewer_zcEE"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission2224/Reviewer_zcEE"], "number": 1, "invitations": ["ICLR.cc/2026/Conference/Submission2224/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1761013162587, "cdate": 1761013162587, "tmdate": 1762916151918, "mdate": 1762916151918, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}, {"content": {"summary": {"value": "The paper introduces the Radon-Nikodym Estimator (RNE), a framework designed to unify various diffusion models by connecting marginal densities with transition kernels through the density ratio between time-reversal processes.  The paper also presents RNE as generalizing existing methods like FKC, TDS, and Itô density estimators, offering increased flexibility and computational efficiency.   Empirical results validate RNE across inference control, energy training, and density estimation on molecular dynamics, drug design, and Gaussian mixtures."}, "soundness": {"value": 2}, "presentation": {"value": 3}, "contribution": {"value": 2}, "strengths": {"value": "1. The RNE framework offers a conceptually appealing and potentially unifying perspective on several recent techniques for controlling and analyzing diffusion models.  \n\n2.  The proposed RNC method appears to offer increased flexibility in designing the sampling ($a_t$) and target ($b_t$) processes compared to methods like FKC, which often have more constrained designs to avoid divergence terms.   \n\n \n3.  The identified potential numerical instability and the introduced reference process are validated by empirical results."}, "weaknesses": {"value": "1. The introduced reference process, while stabilizing the RND estimator's variance, appears to increase the computational cost.\n\n2.  How reference process approach relates conceptually to methods that aim to directly minimize the conditional variance $Var(x_{t_i}|x_{t_{i+1}})$ or reconstruction error during the reverse process itself, rather than stabilizing the estimator of a ratio?  \n \n\n2. While RNC offers flexibility via parameters like $(c_a, c_b)$, the practical advantage over established methods like FKC seems conditional on tuning these parameters.  \n\n3. The paper proposes extending RNE to Continuous Time Markov Chains for discrete diffusion, but this extension is discussed briefly in the appendix (Appendix D) and lacks empirical validation in the experiments section."}, "questions": {"value": "1. Does the performance gain from RNC's flexibility (tuning $c_a, c_b$) consistently outweigh the tuning effort compared to methods like FKC? How can these parameters be chosen efficiently?\n\n2. How does the proposed method handle the numerical instability issue arising from the schedules in diffusion models as $\\sigma_t$ approaches 0? \n\n3.  How sensitive is RNC's performance to score model inaccuracies in practice?  Are there theoretical principles governing this sensitivity or ensuring robustness, apart from the specific case noted for reward-tilting (Proposition 2.2)?"}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "rating": {"value": 4}, "confidence": {"value": 3}, "code_of_conduct": {"value": "Yes"}}, "id": "OIJKK5KUAy", "forum": "fkf7tlkN8q", "replyto": "fkf7tlkN8q", "signatures": ["ICLR.cc/2026/Conference/Submission2224/Reviewer_TNy1"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission2224/Reviewer_TNy1"], "number": 2, "invitations": ["ICLR.cc/2026/Conference/Submission2224/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1761213383623, "cdate": 1761213383623, "tmdate": 1762916151563, "mdate": 1762916151563, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}, {"content": {"summary": {"value": "This paper introduces the Radon–Nikodym Estimator (RNE) to enhance inference-time control and energy-based training for diffusion models. RNE expresses marginal density ratios along the diffusion trajectory as products of ratios between forward and reverse transition kernels across time. The central idea is that a diffusion process and its time-reversal induce the same path measure, yielding a Radon–Nikodym derivative of one; this identity links marginal densities to transition kernels. For inference-time control, RNE supplies importance weights within Sequential Monte Carlo (SMC), providing a plug-and-play recipe that unifies several prior approaches. For energy-based diffusion, RNE serves as a lightweight regularizer that enforces consistency between model-implied marginals and transition kernels during training."}, "soundness": {"value": 3}, "presentation": {"value": 2}, "contribution": {"value": 2}, "strengths": {"value": "Strengths:\n1. Generality and unification. The framework applies broadly across settings by leveraging Bayes’ rule and time-reversal: it covers diverse inference-time control tasks (e.g., annealing, reward tilting, model composition) and extends beyond SDEs to continuous-time Markov chains (CTMCs), demonstrating genuine plug-and-play utility.\n2. Comprehensive empirical evaluation. The method is validated on inference-time annealing (ALDP, LJ-13), model product for multi-target SBDD, scaling with particle count, and energy-based diffusion training (2D and 100D GMM, ALDP). The breadth and relevance of experiments substantiate the approach’s practicality."}, "weaknesses": {"value": "Weaknesses:\n1. Limited algorithmic novelty for control design. While RNE offers a unifying lens over existing methods, the new algorithmic insights for inference-time control are modest. The experimental instantiations primarily focus on drift reweighting, leaving broader design spaces underexplored.\n2. Insufficient non-asymptotic guidance. Much of the theory is asymptotic, abstracting away time discretization and finite-particle effects. Clear prescriptions for step-size selection, resampling schedules, and particle budgets (M) are limited, leaving a potential gap between theory and practice in terms of variance, bias, and weight stability.\n3. Convergence guarantees are implicit. The convergence narrative relies on standard Feynman–Kac SMC theory and RNE discretization analysis, but the paper does not present a single, unified theorem asserting that, as M→∞ and Δt→0, the particle system converges to q_t and ultimately q_0 under the proposed RNE-corrected scheme. Stating assumptions and conclusions explicitly in the main text would improve readability and reduce ambiguity about the limiting operator and target-matching guarantees."}, "questions": {"value": "Questions:\nOne confusing issues are in Section 2.1.1. To ensure the reverse-process marginal matches q_t, and if one interprets the importance weight as a rejection rate, why do the authors use self-normalized importance resampling (SMC) rather than enforcing exact q_t via rejection at each step under a suitable design of a_t and b_t (guarantee the rejection rate)? Under self-normalized SMC, with a finite number of particles, the empirical distribution of X_τ may deviate from q_τ, and this error can accumulate over time. How should M be chosen to control this error in practice?"}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "rating": {"value": 4}, "confidence": {"value": 3}, "code_of_conduct": {"value": "Yes"}}, "id": "eah5s8BxDm", "forum": "fkf7tlkN8q", "replyto": "fkf7tlkN8q", "signatures": ["ICLR.cc/2026/Conference/Submission2224/Reviewer_hh4L"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission2224/Reviewer_hh4L"], "number": 3, "invitations": ["ICLR.cc/2026/Conference/Submission2224/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1761646564377, "cdate": 1761646564377, "tmdate": 1762916151286, "mdate": 1762916151286, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}, {"content": {"summary": {"value": "The paper introduces the Radon–Nikodym Estimator (RNE). The authors make the observation that in diffusion, the forward and backward processes induce the same probability measure over the paths, which translates to their Radon–Nikodym derivative or, equivalently, their ratio, being equal to one. This allows them to calculate marginal densities using just the individual transition kernels, usually learned with a neural network, and cheap to compute. Using this estimator, the authors present different applications in inference-time control and regularization for training energy-based diffusion models."}, "soundness": {"value": 3}, "presentation": {"value": 3}, "contribution": {"value": 3}, "strengths": {"value": "- The proposed estimator provides a clean and elegant way to translate transition kernel probabilities to marginal densities. The idea of exploiting the intrinsic properties of the diffusion process to derive the estimator is novel and does not require any additional simulations, having potentially better scaling properties than previous approaches.\n\n- From my understanding, the advantage of the RNE over the Feynman-Kac Corrector (FKC) is that, compared to FKC, RNE provides an easier way to compute the importance weights for inference-time control. For FKC, the weights are accumulated over the backwards trajectory, which may be problematic, especially when introducing the necessary resampling in Sequential Monte Carlo.\n\n- Since there is no simulation required, the RNE can be computed for two neighboring timesteps using the forward and backward kernels, allowing the authors to utilize it in training an energy-based diffusion model. This extends the applicability of the proposed estimator to more applications than inference-time control."}, "weaknesses": {"value": "- The main comparison regarding inference-time control seems to be with the Feynman-Kac Corrector. Although it is established that using density-ratio estimation scales badly with the number of dimensions, the FKC paper does showcase some results on high-dimensional data (images). The proposed RNE is only applied to low-dimensional settings."}, "questions": {"value": "- Does the RNE compute a different weighting term than the Feynman–Kac formula? When are the two equivalent?\n\n- How does the number of steps affect the Radon-Nikodym estimator? If the sampling is performed with 10 or 20 steps, then the backwards and forwards kernels will be significantly different. If I understand this correctly, the estimator relies on the two kernels being 'similar enough'.\n\n- Are the importance weights for RNE \"better\" than the weights computed with FKC? Is there any intuition of why one should be better than the other? Do better importance weights work with fewer particles during sampling?"}, "flag_for_ethics_review": {"value": ["No ethics review needed."]}, "rating": {"value": 8}, "confidence": {"value": 2}, "code_of_conduct": {"value": "Yes"}}, "id": "bxQ43LAGoj", "forum": "fkf7tlkN8q", "replyto": "fkf7tlkN8q", "signatures": ["ICLR.cc/2026/Conference/Submission2224/Reviewer_WESr"], "nonreaders": [], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission2224/Reviewer_WESr"], "number": 4, "invitations": ["ICLR.cc/2026/Conference/Submission2224/-/Official_Review", "ICLR.cc/2026/Conference/-/Edit"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1761955141544, "cdate": 1761955141544, "tmdate": 1762916150450, "mdate": 1762916150450, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Review", "license": "CC BY 4.0", "version": 2}, {"content": {"title": {"value": "Summary of reponses"}, "comment": {"value": "We thank all the reviewers for their insightful and constructive feedback. We have addressed each concern point-by-point below and updated our manuscript according to the suggestions. In this global response, we summarise four key changes that we have made to our manuscript.\n\n---\n\n### **1. Theoretical guarantees: non-asymptotic bounds and convergence**\n\nFollowing the suggestions of reviewers on more explicit convergence guarantees, we have added the following results:\n\n- **Proposition 3.1 (time discretisation error for RNE):** A **non-asymptotic $L^2$ bound** for the RNE estimator under time discretisation, showing that the error between the ideal continuous-time RNE and its discretised counterpart scales as $\\mathcal{O}(\\sqrt{\\Delta t})$.\n\n- **Proposition 3.2 (RNE-based SMC weight error):** A **non-asymptotic bound for the SMC weights** computed via RNE, which explicitly accounts for both **time discretisation** and **score model error**. The error grows linearly in the score error, plus an additional $\\mathcal{O}(\\sqrt{\\Delta t})$ term.\n\n- **Proposition H.1 (convergence of SMC in the number of particles):** We state the convergence guarantee for the SMC algorithm, showing an $\\mathcal{O}(1/M)$ decay of the error and almost-sure convergence as $M \\to \\infty$ under mild boundedness assumptions.\n\n---\n\n\n### **2. Experimental validation of RNE for CTMCs**\n\n\n\nWe added a new experiment on **ImageNet-256** with a **masked discrete diffusion model** to verify the applicability of our RNE for CTMC. \nWe consider a text-prompted reward-tilting task.   As shown in Fig. 8 of the updated manuscript, our method significantly improves alignment between generated images and text prompts, demonstrating that the CTMC extension of RNE is not only theoretically sound but also **effective in discrete diffusion in high-dimensional space**.\n\n---\n\n### **3. More flexible control task**\n\nTo highlight that RNE enables more general control tasks, we added a **maze-navigation \"stitching\" task**:\n\nWe train a diffusion model on **short trajectories**, and we seek to *stitch* these into long paths under a **global reward** enforcing endpoint and connectivity between short trajectories. This defines a **composition + reward-tilting problem over path segments**, which is not straightforward in previous works like FKC. RNC handles this task without changing the general SMC weight formula and achieves a 100% success rate (Tab. 3, Fig. 7).\n\nTogether with the CTMC results, this clarifies that RNE not only generalise previous approaches allowing different drifts: it provides a **single plug-and-play recipe that can be instantiated for diverse control tasks and modalities**.\n\n---\n\n\n### **4. Empirical study on score error, time discretisation, and denoising kernels**\n\nWe presented a empirical study on how RNE behaves under **score error**, **coarse time discretisation (few steps)**, and **different denoising kernels**:\n\n- **Score error and number of steps (Appendix F.4):**  \n  On ALDP inference-time annealing, we vary the number of steps and the score quality (via early stopping in training). While RNC degrades when using very few steps or a poorly trained score, it still outperforms the heuristic baseline without SMC.\n\n- **Effectiveness of the reference process with improved denoising kernels (Appendix F.5):**  \n  We compare standard EM discretisation vs. advanced denoising kernels with estimated variance, each with and without our reference process. We observe that better denoising kernels reduce the error of RNE, and the reference process provides a substantial additional gain in both cases. This verifies the effectiveness and robustness of our proposed reference process.\n\n---\n\nIn summary, we have strengthened our theoretical contributions and extended the empirical scope of our experiments. Again, we sincerely thank all reviewers for their time and thoughtful feedback, which has helped us substantially improve our manuscript."}}, "id": "GhQT7N74pe", "forum": "fkf7tlkN8q", "replyto": "fkf7tlkN8q", "signatures": ["ICLR.cc/2026/Conference/Submission2224/Authors"], "readers": ["everyone"], "writers": ["ICLR.cc/2026/Conference", "ICLR.cc/2026/Conference/Submission2224/Authors"], "number": 8, "invitations": ["ICLR.cc/2026/Conference/Submission2224/-/Official_Comment"], "domain": "ICLR.cc/2026/Conference", "tcdate": 1763503644730, "cdate": 1763503644730, "tmdate": 1763504088343, "mdate": 1763504088343, "parentInvitations": "ICLR.cc/2026/Conference/-/Official_Comment", "license": "CC BY 4.0", "version": 2}], "withdrawn": false}